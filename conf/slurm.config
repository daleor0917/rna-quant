/*
========================================================================================
    Slurm + Docker Configuration - CORRECTED
========================================================================================
    Small jobs (≤2GB) → nodoB (laptop) - Priority
    Big jobs (>3GB) → nodoA (forced) - Has more RAM
========================================================================================
*/

workDir = '/shared/work'

process {
    executor = 'slurm'
    queue    = 'cpu'
    
    // Defaults - small jobs
    cpus   = 1
    memory = '2 GB'
    time   = '1h'
    
    // Default: allow any node
    clusterOptions = '--chdir=/shared'
    
    // ========================================
    // Small jobs (≤2GB) → Can run on laptop
    // ========================================
    
    withName: 'SAMTOOLS_INDEX' {
        cpus   = 2
        memory = '2 GB'
        time   = '30m'
        clusterOptions = '--chdir=/shared'
    }
    
    withName: 'CUSTOM_DUMPSOFTWAREVERSIONS' {
        cpus   = 1
        memory = '1 GB'
        time   = '10m'
        clusterOptions = '--chdir=/shared'
    }
    
    withName: 'MULTIQC' {
        cpus   = 1
        memory = '2 GB'
        time   = '30m'
        clusterOptions = '--chdir=/shared'
    }
    
    withName: 'FASTQC' {
        cpus   = 2
        memory = '2 GB'
        time   = '1h'
        clusterOptions = '--chdir=/shared'
    }
    
    // ========================================
    // Big jobs (>3GB) → FORCE to nodoA
    // ========================================
    
    withName: 'SUBREAD_FEATURECOUNTS' {
        cpus   = 2
        memory = '4 GB'
        time   = '2h'
        // FORCE to nodoA (laptop doesn't have 6GB)
        clusterOptions = '--chdir=/shared --nodelist=nodoA'
    }
    
    withName: 'RSEQC_TIN' {
        cpus   = 2
        memory = '4 GB'
        time   = '1h'
        // FORCE to nodoA (laptop only has 3.6GB)
        clusterOptions = '--chdir=/shared --nodelist=nodoA'
    }
}

profiles {
    slurm {
        process.executor = 'slurm'
        process.queue    = 'cpu'
        
        docker.enabled = true
        docker.runOptions = '-u $(id -u):$(id -g)'
        
        workDir = '/shared/work'
    }
}

executor {
    name = 'slurm'
    queueSize = 10
    pollInterval = '10 sec'
    submitRateLimit = '5 sec'
}