/*
========================================================================================
    Container Configuration - Simplified Version
========================================================================================
    Docker and Singularity container definitions for pipeline processes
    Automatically detects container engine and uses appropriate image format
----------------------------------------------------------------------------------------
*/

// Profiles for container engines
profiles {
    docker {
        docker.enabled         = true
        docker.registry        = 'quay.io'
        docker.runOptions      = '-u $(id -u):$(id -g)'
        singularity.enabled    = false
    }
    
    singularity {
        singularity.enabled    = true
        singularity.autoMounts = true
        singularity.registry   = 'quay.io'
        docker.enabled         = false
    }
}

// Process-specific container definitions
process {

    // SAMTOOLS_INDEX: Index BAM files
    withName: SAMTOOLS_INDEX {
        container = {
            workflow.containerEngine == 'singularity' 
                ? 'https://depot.galaxyproject.org/singularity/samtools:1.22.1--h96c455f_0' 
                : 'quay.io/biocontainers/samtools:1.22.1--h96c455f_0'
        }
    }

    // SUBREAD_FEATURECOUNTS: Count reads aligned to genomic features
    withName: SUBREAD_FEATURECOUNTS {
        container = {
            workflow.containerEngine == 'singularity' 
                ? 'https://depot.galaxyproject.org/singularity/subread:2.0.6--he4a0461_2' 
                : 'quay.io/biocontainers/subread:2.0.6--he4a0461_2'
        }
    }

    // RSEQC_TIN: Calculate Transcript Integrity Number
    withName: RSEQC_TIN {
        container = {
            workflow.containerEngine == 'singularity' 
                ? 'https://depot.galaxyproject.org/singularity/rseqc:5.0.3--py39hf95cd2a_0' 
                : 'quay.io/biocontainers/rseqc:5.0.3--py39hf95cd2a_0'
        }
    }

    // CUSTOM_DUMPSOFTWAREVERSIONS: Dump software versions for reporting
    withName: CUSTOM_DUMPSOFTWAREVERSIONS {
        container = {
            workflow.containerEngine == 'singularity' 
                ? 'https://community-cr-prod.seqera.io/docker/registry/v2/blobs/sha256/8c/8c6c120d559d7ee04c7442b61ad7cf5a9e8970be5feefb37d68eeaa60c1034eb/data' 
                : 'community.wave.seqera.io/library/multiqc:1.32--d58f60e4deb769bf'
        }
    }

    // MULTIQC: Aggregate results and generate QC report
    withName: MULTIQC {
        container = {
            workflow.containerEngine == 'singularity' 
                ? 'https://community-cr-prod.seqera.io/docker/registry/v2/blobs/sha256/8c/8c6c120d559d7ee04c7442b61ad7cf5a9e8970be5feefb37d68eeaa60c1034eb/data' 
                : 'community.wave.seqera.io/library/multiqc:1.32--d58f60e4deb769bf'
        }
    }

}

/*
========================================================================================
    USAGE NOTES
========================================================================================
    This configuration will automatically detect whether Docker or Singularity is 
    available in your execution environment and use the appropriate container format.

    To use this configuration, include it in your nextflow.config:
        includeConfig 'docker.config'

    Or specify it on the command line:
        nextflow run main.nf -c docker.config

    The pipeline will work with:
    - Docker (default on most systems)
    - Singularity/Apptainer (HPC environments)
    
    No profile selection needed - it auto-detects!
========================================================================================
*/